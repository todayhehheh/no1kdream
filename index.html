<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    // [중요] getDoc, doc 추가
    import { getFirestore, collection, addDoc, query, where, getDocs, Timestamp, getDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // 1. 기본 광고 (DB 로딩 전이나 없을 때 표시)
    const DEFAULT_ADS = {
        ad1: { image: "https://via.placeholder.com/300x150/333/fff?text=Loading...", link: "#" },
        ad2: { image: "https://via.placeholder.com/300x150/333/fff?text=Loading...", link: "#" }
    };

    const firebaseConfig = {
      apiKey: "AIzaSyAalHhoEK-ko55Jep-7k8ULHeaWWU99oh8",
      authDomain: "dream-meal-support.firebaseapp.com",
      projectId: "dream-meal-support",
      storageBucket: "dream-meal-support.firebasestorage.app",
      messagingSenderId: "230720243044",
      appId: "1:230720243044:web:eb38ecc28353a1c70aa671"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // [신규] 광고 불러오기 함수
    const loadAds = async () => {
        try {
            const docRef = doc(db, "settings", "ads");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                // DB 데이터가 있으면 적용
                if(data.ad1_img) document.getElementById('ad1').style.backgroundImage = `url('${data.ad1_img}')`;
                if(data.ad1_link) document.getElementById('ad1Link').href = data.ad1_link;
                
                if(data.ad2_img) document.getElementById('ad2').style.backgroundImage = `url('${data.ad2_img}')`;
                if(data.ad2_link) document.getElementById('ad2Link').href = data.ad2_link;
            } else {
                // 없으면 기본값
                applyDefaultAds();
            }
        } catch(e) {
            console.error("광고 로딩 오류:", e);
            applyDefaultAds();
        }
    };

    const applyDefaultAds = () => {
        document.getElementById('ad1').style.backgroundImage = `url('${DEFAULT_ADS.ad1.image}')`;
        document.getElementById('ad2').style.backgroundImage = `url('${DEFAULT_ADS.ad2.image}')`;
    };

    // 초기화 시 실행
    loadAds();

    // ... (이하 기존 로직 동일: currentType, openCombinedModal, processAllInOne, registerUser 등) ...
    // 지면상 생략, 기존 index.html의 나머지 스크립트는 그대로 유지하세요.
    
    let currentType = ""; let currentTargetName = "";
    window.openCombinedModal = (type, targetName = "") => { /* ... */ document.getElementById('loginModal').style.display = 'flex'; };
    window.processAllInOne = async () => { /* ... 기존과 동일 ... */ };
    window.closeModal = (id) => document.getElementById(id).style.display = 'none';
    window.openRegisterModal = () => document.getElementById('registerModal').style.display = 'flex';
    window.registerUser = async () => { /* ... */ };
</script>
